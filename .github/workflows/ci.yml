name: Clothes & Shoes ML CI Pipeline

# Trigger the workflow on pushes or pull requests to the master or main branch
on:
  push:
    branches: [ master, main ]
  pull_request:
    branches: [ master, main ]

jobs:
  # Job 1: Build, Lint, and Test
  build-and-test:
    runs-on: ubuntu-latest # Use the latest Linux runner environment
    
    steps:
    - name: 1. Checkout Repository Code
      uses: actions/checkout@v4 # Gets a copy of your code

    - name: 2. Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: 3. Install Dependencies
      # This assumes you have a requirements.txt with: pandas, scikit-learn, flake8, joblib
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: 4. ‚öôÔ∏è Run Code Linter (Lint Job)
      # Check for style guide violations in all Python files in the src directory
      run: flake8 src/ --max-line-length=120 
      
    - name: 5. üß™ Run ML Model Tests (Test Job)
      # Execute the test script. If it raises an AssertionError (MAE is too high), the CI fails.
      run: python src/test.py